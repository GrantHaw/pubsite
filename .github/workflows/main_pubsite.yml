name: Build & deploy to Azure Web App (pubsite)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  id-token: write      # OIDC for azure/login

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    # OIDC login
    - name: Azure login
      uses: azure/login@v2
      with:
        client-id:      ${{ secrets.AZUREAPPSERVICE_CLIENTID_E5978DC6004B4BB995ACD60ADAF513EF }}
        tenant-id:      ${{ secrets.AZUREAPPSERVICE_TENANTID_8824E98435E440FAA46E146AD7716A44 }}
        subscription-id: ${{ secrets.AZUREAPPSERVICE_SUBSCRIPTIONID_6A3ECC57385541ACB3AC40EA396FC5B5 }}

    # Zip **source** â€“ let Oryx handle install & build on the server
    - name: Zip source
      run: zip -r pubsite.zip . -x ".git/*" -x ".github/*"

    - name: Deploy to Azure Web App
      uses: azure/webapps-deploy@v3
      with:
        app-name: pubsite
        package: pubsite.zip         # raw source
